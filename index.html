<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile Rater</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for aesthetic enhancements */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0d1117; /* Dark background */
        }
        .file-input-label {
            transition: all 0.2s ease-in-out;
            cursor: pointer;
            border: 2px dashed #4b5563; /* Gray border */
        }
        .file-input-label:hover {
            border-color: #60a5fa; /* Blue hover */
            background-color: #1f2937;
        }
        /* Ensure video feed covers the container */
        #video-stream {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            transform: scaleX(-1); /* Mirror effect for user-facing camera */
        }
        /* Style for the preview container */
        .preview-container {
            border: 2px dashed #4b5563;
        }
        .preview-container.has-image {
            border: none;
        }
    </style>
</head>
<body class="p-4 sm:p-8 min-h-screen flex items-center justify-center">

    <div id="app-container" class="w-full max-w-4xl bg-[#161b22] p-6 sm:p-10 rounded-xl shadow-2xl text-white">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">

            <!-- Front Profile -->
            <div class="bg-[#0d1117] p-4 rounded-lg shadow-inner">
                <label class="block text-lg font-semibold mb-3 p-1 text-center text-gray-300">Front Face Image</label>
                
                <!-- Preview Area -->
                <div id="front-preview-container" class="preview-container w-full h-64 rounded-xl bg-[#21262d] flex items-center justify-center relative overflow-hidden transition-all duration-300">
                    <img id="front-preview" class="hidden w-full h-full object-cover rounded-lg" alt="Front Profile Preview">
                    <span id="front-placeholder" class="text-center p-4 absolute text-gray-500">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 mx-auto mb-2 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                        </svg>
                        No Image Selected
                    </span>
                </div>

                <!-- Controls -->
                <div class="mt-4 flex space-x-4">
                    <input type="file" id="front-upload" accept="image/*" class="hidden" onchange="handleFileInput(this, 'front')">
                    <label for="front-upload" class="flex-1 px-4 py-2 text-center bg-gray-600 hover:bg-gray-700 text-white font-semibold rounded-lg transition-colors cursor-pointer">
                        Upload File
                    </label>
                    <button onclick="openCamera('front')" class="flex-1 px-4 py-2 bg-[#60a5fa] hover:bg-blue-600 text-white font-semibold rounded-lg transition-colors">
                        Take Live Photo
                    </button>
                </div>
            </div>

            <!-- Side Profile -->
            <div class="bg-[#0d1117] p-4 rounded-lg shadow-inner">
                <label class="block text-lg font-semibold mb-3 p-1 text-center text-gray-300">Side Profile Image</label>
                
                <!-- Preview Area -->
                <div id="side-preview-container" class="preview-container w-full h-64 rounded-xl bg-[#21262d] flex items-center justify-center relative overflow-hidden transition-all duration-300">
                    <img id="side-preview" class="hidden w-full h-full object-cover rounded-lg" alt="Side Profile Preview">
                    <span id="side-placeholder" class="text-center p-4 absolute text-gray-500">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 mx-auto mb-2 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4" />
                        </svg>
                        No Image Selected
                    </span>
                </div>

                <!-- Controls -->
                <div class="mt-4 flex space-x-4">
                    <input type="file" id="side-upload" accept="image/*" class="hidden" onchange="handleFileInput(this, 'side')">
                    <label for="side-upload" class="flex-1 px-4 py-2 text-center bg-gray-600 hover:bg-gray-700 text-white font-semibold rounded-lg transition-colors cursor-pointer">
                        Upload File
                    </label>
                    <button onclick="openCamera('side')" class="flex-1 px-4 py-2 bg-[#60a5fa] hover:bg-blue-600 text-white font-semibold rounded-lg transition-colors">
                        Take Live Photo
                    </button>
                </div>
            </div>
        </div>

        <!-- Action Button -->
        <div class="text-center">
            <button id="rate-button" onclick="getRating()" disabled class="px-8 py-3 text-xl font-bold rounded-full transition-all duration-300
                bg-gray-700 text-gray-500 cursor-not-allowed hover:scale-105 shadow-lg">
                Get Harmony Score (1-10)
            </button>
        </div>

        <!-- Result Display Area -->
        <div id="result-area" class="mt-10 p-6 sm:p-8 bg-[#21262d] rounded-xl hidden">
            <h2 class="text-2xl font-bold mb-4 text-center text-[#60a5fa]">Analysis Complete!</h2>
            <div id="rating-output" class="text-center">
                <!-- Rating will be injected here -->
            </div>
        </div>

        <!-- Custom Alert/Modal -->
        <div id="custom-modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden">
            <div class="bg-[#161b22] p-6 rounded-lg shadow-2xl max-w-sm w-full text-center border border-yellow-500">
                <h3 class="text-xl font-bold text-yellow-400 mb-3">Wait!</h3>
                <p id="modal-message" class="text-gray-300 mb-5">Please upload both a Front Face Image and a Side Profile Image before getting your score.</p>
                <button onclick="document.getElementById('custom-modal').classList.add('hidden')" 
                        class="bg-[#60a5fa] hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg transition">
                    Got it
                </button>
            </div>
        </div>

        <!-- Camera Modal (New Element) -->
        <div id="camera-modal" class="fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 hidden">
            <div class="bg-[#161b22] p-6 rounded-xl shadow-2xl max-w-xl w-full text-center border border-[#60a5fa]">
                <h3 class="text-xl font-bold text-[#60a5fa] mb-4">Capture Profile Image</h3>
                
                <!-- Video Stream and Canvas for Capture -->
                <div class="relative w-full aspect-video bg-black rounded-lg mb-4 overflow-hidden mx-auto">
                    <!-- Video element for live stream -->
                    <video id="video-stream" autoplay playsinline class="w-full h-full object-cover"></video>
                    <!-- Canvas (hidden, used for capture) -->
                    <canvas id="photo-canvas" class="hidden"></canvas>
                </div>

                <!-- Camera Controls -->
                <div class="flex justify-between items-center mt-6">
                    <button onclick="closeCamera()" class="px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white font-bold rounded-lg transition">
                        Cancel
                    </button>
                    <button id="capture-button" onclick="takePhoto()" disabled class="px-6 py-3 bg-red-600 hover:bg-red-700 text-white font-extrabold rounded-full transition duration-150 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 inline-block mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.218A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.218A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" />
                          <path stroke-linecap="round" stroke-linejoin="round" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" />
                        </svg>
                        Take Photo
                    </button>
                </div>
            </div>
        </div>

    </div>

    <script>
        const frontInput = document.getElementById('front-upload');
        const sideInput = document.getElementById('side-upload');
        const rateButton = document.getElementById('rate-button');

        // Camera elements
        const videoStream = document.getElementById('video-stream');
        const photoCanvas = document.getElementById('photo-canvas');
        const cameraModal = document.getElementById('camera-modal');
        const captureButton = document.getElementById('capture-button');
        let currentStream = null;
        let captureTarget = null; // 'front' or 'side'

        // --- FACE SHAPE DATA STRUCTURE ---
        const faceShapes = {
            'Oval': {
                description: 'An **Oval** face is well-balanced, with the forehead slightly wider than the chin. It is considered the "ideal" shape for versatility.',
                recommendations: [
                    'Short to medium length cuts (e.g., classic side part, textured quiff).',
                    'Avoid heavy, full bangs or a massive fringe, as this can make the face look too round.',
                    'Keep hair off the face to show off the balance of your features.'
                ]
            },
            'Square': {
                description: 'A **Square** face is characterized by a strong, broad forehead and a wide, angular jawline. The width and length are proportional.',
                recommendations: [
                    'Short styles with soft texture (e.g., controlled fades, messy crew cuts) to complement the strong jaw.',
                    'Medium length side parts or styles with height and movement on top to **elongate the face** slightly.',
                    'Avoid blunt bangs or straight, heavy horizontal lines that emphasize the jaw\'s width.'
                ]
            },
            'Round': {
                description: 'A **Round** face is nearly equal in width and length, with soft curves and minimal angles. The widest part is at the cheeks.',
                recommendations: [
                    'Styles with **height and volume on top** (e.g., high quiff, pompadour) to elongate the face.',
                    'Hair should be shorter on the sides (fades or tapered) and longer on top.',
                    'Avoid heavy, rounded fringes or cuts that sit right at the chin, which can accentuate the roundness.'
                ]
            },
            'Diamond': {
                description: 'A **Diamond** face features a narrow forehead and jawline, with the widest point being the cheekbones.',
                recommendations: [
                    'Medium to long styles that can be tucked behind the ears (to show off cheekbones).',
                    'Fringes or bangs that soften the forehead and minimize the width of the cheekbones.',
                    'Avoid excess height on top, which can make the forehead appear even more narrow.'
                ]
            },
            'Heart': {
                description: 'A **Heart** face is wide at the forehead and temples, and tapers down to a narrow, sometimes pointed, chin.',
                recommendations: [
                    'Medium length styles that add **width around the chin** (e.g., layers that hit the jaw).',
                    'Side-swept bangs or deep side parts to soften the forehead.',
                    'Avoid super high volume or tight cuts on the crown, which can make the forehead look wider.'
                ]
            }
        };
        // --- END FACE SHAPE DATA STRUCTURE ---


        // Function to check if both files are present and enable/disable the button
        function checkInputs() {
            const isReady = frontInput.files.length > 0 && sideInput.files.length > 0;
            rateButton.disabled = !isReady;
            if (isReady) {
                rateButton.classList.remove('bg-gray-700', 'text-gray-500', 'cursor-not-allowed');
                rateButton.classList.add('bg-[#60a5fa]', 'text-white', 'hover:bg-blue-600');
            } else {
                rateButton.classList.add('bg-gray-700', 'text-gray-500', 'cursor-not-allowed');
                rateButton.classList.remove('bg-[#60a5fa]', 'text-white', 'hover:bg-blue-600');
            }
        }

        // Function to update the preview image in the UI
        function updatePreview(file, target) {
            const preview = document.getElementById(`${target}-preview`);
            const placeholder = document.getElementById(`${target}-placeholder`);
            const container = document.getElementById(`${target}-preview-container`);
            
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.src = e.target.result;
                    preview.classList.remove('hidden');
                    placeholder.classList.add('hidden');
                    container.classList.add('has-image');
                };
                reader.readAsDataURL(file);
            } else {
                preview.src = '';
                preview.classList.add('hidden');
                placeholder.classList.remove('hidden');
                container.classList.remove('has-image');
            }
        }

        // Function to link the File object to the hidden input (so checkInputs works)
        function updateInputFiles(file, target) {
            const input = document.getElementById(`${target}-upload`);
            
            // Create a new DataTransfer/FileList object to simulate file upload
            const dataTransfer = new DataTransfer();
            if (file) {
                dataTransfer.items.add(file);
            }
            input.files = dataTransfer.files;
            
            // Update the preview and check button state
            updatePreview(file, target);
            checkInputs();
        }

        // Handler for file input change event
        function handleFileInput(input, target) {
            const file = input.files[0];
            updateInputFiles(file, target);
        }

        // --- Camera Functions ---

        // Open the camera modal and start stream
        async function openCamera(target) {
            captureTarget = target;
            
            // Clear previous stream if any
            if (currentStream) {
                currentStream.getTracks().forEach(track => track.stop());
            }

            cameraModal.classList.remove('hidden');
            captureButton.disabled = true; // Disable button until video is loaded
            
            try {
                // Request access to the user-facing camera
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: 'user' } 
                });
                currentStream = stream;
                videoStream.srcObject = stream;
                
                // Once metadata is loaded (stream is active) enable capture button
                videoStream.onloadedmetadata = () => {
                    captureButton.disabled = false;
                    videoStream.play();
                };

            } catch (err) {
                console.error("Error accessing camera: ", err);
                showModal("Could not access camera. Please ensure your device permits camera access or use the 'Upload File' option.");
                closeCamera();
            }
        }

        // Close the camera modal and stop stream
        function closeCamera() {
            cameraModal.classList.add('hidden');
            captureButton.disabled = true;
            
            if (currentStream) {
                currentStream.getTracks().forEach(track => track.stop());
                currentStream = null;
            }
        }

        // Capture the photo from the video stream
        function takePhoto() {
            if (!currentStream || !captureTarget) return;
            
            const context = photoCanvas.getContext('2d');
            
            // Set canvas dimensions to match the video element's natural size
            photoCanvas.width = videoStream.videoWidth;
            photoCanvas.height = videoStream.videoHeight;
            
            // Draw the current video frame onto the canvas
            // We use context transforms to flip the image back to normal orientation 
            // since the video stream is mirrored for a better user experience.
            context.save();
            context.scale(-1, 1); // Flip horizontally
            context.drawImage(videoStream, 
                -photoCanvas.width, // Start drawing from negative width to compensate for the flip
                0, 
                photoCanvas.width, 
                photoCanvas.height
            );
            context.restore();
            
            // Convert canvas data to a Blob/File
            photoCanvas.toBlob((blob) => {
                // Create a File object from the blob
                const photoFile = new File([blob], `${captureTarget}_profile_${Date.now()}.png`, {
                    type: 'image/png',
                    lastModified: Date.now()
                });

                // Update the hidden file input with the new photo and update UI
                updateInputFiles(photoFile, captureTarget);
                
                // Close the camera modal
                closeCamera();
                
            }, 'image/png');
        }

        // Function to show the custom modal with a specific message (Original Logic)
        function showModal(message) {
            document.getElementById('modal-message').textContent = message;
            document.getElementById('custom-modal').classList.remove('hidden');
        }

        // Simulated AI Rating Logic (UPDATED for realistic scores and detailed feedback)
        function getRating() {
            if (!rateButton.disabled) {
                // Hide button and show loading state
                rateButton.textContent = "Analyzing...";
                rateButton.disabled = true;

                // Simulate processing time
                setTimeout(() => {
                    const resultArea = document.getElementById('result-area');
                    const ratingOutput = document.getElementById('rating-output');

                    // --- UPDATED: Adjusted Score Range (4.0 to 9.5) ---
                    const score = (Math.random() * (9.5 - 4.0) + 4.0).toFixed(1);
                    const scoreValue = parseFloat(score);
                    
                    // --- UPDATED: Detailed Feedback Data with specific tips ---
                    const compliments = [
                        'Excellent midface ratio and cranial dimensions.',
                        'Strong facial projection and good hair line density.',
                        'Good brow ridge definition.',
                        'Clear skin texture and bright eyes.',
                        'Harmonious facial thirds.',
                        'High facial symmetry observed.'
                    ];

                    const constructiveFeedback = [
                        'Improve jawline definition through posture correction or targeted exercises.',
                        // Debloating tip
                        'Focus on **debloating** by reducing sodium/alcohol intake, increasing water consumption, and eating foods high in **potassium** (e.g., bananas, sweet potatoes) to reduce water retention and reveal structure.',
                        'Consider strategies to subtly improve **bone mass** and overall facial volume.',
                        'Minor facial asymmetry detected; focus on unilateral muscle balance.',
                        'Enhance orbital area definition to improve eye prominence.',
                        'Improve the prominence of the chin and jaw angle for stronger side profile.',
                        'Increase facial sharpness by reducing overall body fat percentage.',
                        // Unibrow tip
                        'A subtle **unibrow** is present; maintenance of the glabellar area (between the eyebrows) can enhance the central face clarity.'
                    ];

                    // Helper to get unique random items
                    function getRandomItems(arr, num) {
                        const shuffled = arr.sort(() => 0.5 - Math.random());
                        return shuffled.slice(0, num);
                    }

                    // --- Dynamic Analysis Construction ---
                    let feedbackHTML = '';
                    let summaryTitle = '';
                    
                    // 1. Determine Summary Title and Select Feedback
                    if (scoreValue >= 8.5) {
                        summaryTitle = 'Exceptional Profile: Excellent Aesthetics';
                        // Pick 3 compliments and 1 minor critique
                        const randomCompliments = getRandomItems(compliments, 3);
                        const randomCritiques = getRandomItems(constructiveFeedback, 1);
                        
                        feedbackHTML += '<p class="text-green-400 font-semibold mb-2">Key Strengths:</p>';
                        feedbackHTML += '<ul class="list-disc list-inside ml-4 text-gray-300 space-y-1">' + 
                                        randomCompliments.map(c => `<li>${c}</li>`).join('') + 
                                        '</ul>';
                        feedbackHTML += '<p class="text-yellow-400 font-semibold mt-4 mb-2">Area for Improvement:</p>';
                        feedbackHTML += '<ul class="list-disc list-inside ml-4 text-gray-300 space-y-1">' + 
                                        randomCritiques.map(c => `<li>${c}</li>`).join('') + 
                                        '</ul>';

                    } else if (scoreValue >= 6.5) {
                        summaryTitle = 'Harmonious Profile: Above Average Aesthetics';
                        // Pick 2 compliments and 2 critiques
                        const randomCompliments = getRandomItems(compliments, 2);
                        const randomCritiques = getRandomItems(constructiveFeedback, 2);
                        
                        feedbackHTML += '<p class="text-green-400 font-semibold mb-2">Key Strengths:</p>';
                        feedbackHTML += '<ul class="list-disc list-inside ml-4 text-gray-300 space-y-1">' + 
                                        randomCompliments.map(c => `<li>${c}</li>`).join('') + 
                                        '</ul>';
                        feedbackHTML += '<p class="text-yellow-400 font-semibold mt-4 mb-2">Areas for Improvement:</p>';
                        feedbackHTML += '<ul class="list-disc list-inside ml-4 text-gray-300 space-y-1">' + 
                                        randomCritiques.map(c => `<li>${c}</li>`).join('') + 
                                        '</ul>';
                    } else {
                        summaryTitle = 'Developing Profile: Potential for Improvement';
                        // Pick 1 compliment and 3 critiques
                        const randomCompliments = getRandomItems(compliments, 1);
                        const randomCritiques = getRandomItems(constructiveFeedback, 3);
                        
                        feedbackHTML += '<p class="text-green-400 font-semibold mb-2">Key Strength:</p>';
                        feedbackHTML += '<ul class="list-disc list-inside ml-4 text-gray-300 space-y-1">' + 
                                        randomCompliments.map(c => `<li>${c}</li>`).join('') + 
                                        '</ul>';
                        feedbackHTML += '<p class="text-red-400 font-semibold mt-4 mb-2">Primary Focus Areas:</p>';
                        feedbackHTML += '<ul class="list-disc list-inside ml-4 text-gray-300 space-y-1">' + 
                                        randomCritiques.map(c => `<li>${c}</li>`).join('') + 
                                        '</ul>';
                    }
                    
                    // --- Face Shape Analysis (New Section) ---
                    const shapes = Object.keys(faceShapes);
                    const randomShapeKey = shapes[Math.floor(Math.random() * shapes.length)];
                    const shapeData = faceShapes[randomShapeKey];

                    const faceShapeHTML = `
                        <div class="mt-8 pt-4 border-t border-gray-700 text-left">
                            <h3 class="text-xl font-bold text-yellow-400 mb-2">Simulated Face Shape: <span class="text-white">${randomShapeKey}</span></h3>
                            <p class="text-sm text-gray-400 mb-4">${shapeData.description}</p>
                            <h4 class="text-lg font-semibold text-[#60a5fa] mb-2">Top Haircut Recommendations:</h4>
                            <ul class="list-disc list-inside ml-4 text-gray-300 space-y-1">
                                ${shapeData.recommendations.map(r => `<li>${r}</li>`).join('')}
                            </ul>
                        </div>
                    `;


                    // 3. Display the result
                    ratingOutput.innerHTML = `
                        <p class="text-8xl font-black text-transparent bg-clip-text bg-gradient-to-r from-red-500 via-yellow-400 to-green-500 mb-4">${score}</p>
                        <p class="text-2xl font-semibold text-gray-200">${summaryTitle}</p>
                        
                        <div class="max-w-lg mx-auto">
                            <!-- Feedback Section -->
                            <div class="mt-5 space-y-3 text-left">
                                ${feedbackHTML}
                            </div> 
                            
                            <!-- Face Shape Section -->
                            ${faceShapeHTML}
                            
                        </div>

                        <p class="text-sm text-gray-500 mt-6">Score based on simulated profile analysis and proportion calculation.</p>
                    `;
                    
                    resultArea.classList.remove('hidden');

                    // Reset button
                    rateButton.textContent = "Get Harmony Score (1-10)";
                    checkInputs(); // Re-enable if files are still loaded

                    // Scroll to result
                    resultArea.scrollIntoView({ behavior: 'smooth' });

                }, 2500); // 2.5 seconds processing time
            } else {
                showModal("Please upload both a Front Face Image and a Side Profile Image before getting your score.");
            }
        }

        // Initial check on load
        window.onload = checkInputs;
    </script>

</body>
</html>
